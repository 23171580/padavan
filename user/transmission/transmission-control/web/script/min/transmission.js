var transmission={SessionId:"",isInitialized:false,host:"",port:"9091",path:"/transmission/rpc",rpcpath:"../rpc",fullpath:"",on:{torrentCountChange:null,postError:null},username:"",password:"",_status:{stopped:0,checkwait:1,check:2,downloadwait:3,download:4,seedwait:5,seed:6,actively:101},options:{getFolders:true,getTarckers:true},headers:{},trackers:{},islocal:false,downloadDirs:[],getSessionId:function(a,b){jQuery.ajax({type:"POST",url:this.fullpath,error:function(d){var c="";if(d.status===409&&
(c=d.getResponseHeader("X-Transmission-Session-Id"))){a.isInitialized=true;a.SessionId=c;a.headers["X-Transmission-Session-Id"]=c;b&&b()}},headers:this.headers})},init:function(a,b){jQuery.extend(this,a);if(this.username&&this.password)this.headers.Authorization="Basic "+(new Base64).encode(this.username+":"+this.password);this.fullpath=this.rpcpath;this.getSessionId(this,b)},exec:function(a,b,d){if(!this.isInitialized)return false;var c={method:"",arguments:{},tag:""};jQuery.extend(c,a);var e={type:"POST",
url:this.fullpath,dataType:"json",data:JSON.stringify(c),success:function(f){b&&b(f,d)},error:function(f){var g="";if(f.status===409&&(g=f.getResponseHeader("X-Transmission-Session-Id"))){transmission.SessionId=g;transmission.headers["X-Transmission-Session-Id"]=g;jQuery.ajax(e)}else transmission.on.postError&&transmission.on.postError(f)},headers:this.headers};jQuery.ajax(e)},getStatus:function(a){this.exec({method:"session-stats"},function(b){if(b.result=="success"){a&&a(b.arguments);if(transmission.torrents.count!=
b.arguments.torrentCount||transmission.torrents.activeTorrentCount!=b.arguments.activeTorrentCount||transmission.torrents.pausedTorrentCount!=b.arguments.pausedTorrentCount){transmission.torrents.count=b.arguments.torrentCount;transmission.torrents.activeTorrentCount=b.arguments.activeTorrentCount;transmission.torrents.pausedTorrentCount=b.arguments.pausedTorrentCount;transmission._onTorrentCountChange()}}})},getSession:function(a){this.exec({method:"session-get"},function(b){b.result=="success"&&
a&&a(b.arguments)})},addTorrentFromUrl:function(a,b,d,c){if(a.match(/^[0-9a-f]{40}$/i))a="magnet:?xt=urn:btih:"+a;a={method:"torrent-add",arguments:{filename:a,paused:!d}};if(b)a.arguments["download-dir"]=b;this.exec(a,function(e){switch(e.result){case "success":if(c)if(e.arguments["torrent-added"])c(e.arguments["torrent-added"]);else e.arguments["torrent-duplicate"]&&c({status:"duplicate",torrent:e.arguments["torrent-duplicate"]});break;default:c&&c(e.result)}})},addTorrentFromFile:function(a,b,
d,c,e){var f=new FileReader;f.onload=function(g){g=g.target.result;var h=g.indexOf("base64,");if(h!=-1){g=g.substring(h+7);transmission.exec({method:"torrent-add",arguments:{metainfo:g,"download-dir":b,paused:d}},function(i){switch(i.result){case "success":c&&c(i.arguments["torrent-added"],e);break;case "duplicate torrent":c&&c("duplicate")}})}};f.readAsDataURL(a)},_onTorrentCountChange:function(){this.torrents.loadSimpleInfo=false;this.on.torrentCountChange&&this.on.torrentCountChange()},removeTorrent:function(a,
b,d){this.exec({method:"torrent-remove",arguments:{ids:a,"delete-local-data":b}},function(c){d&&d(c.result)})},getFreeSpace:function(a,b){this.exec({method:"free-space",arguments:{path:a}},function(d){b&&b(d)})},updateBlocklist:function(a){this.exec({method:"blocklist-update"},function(b){a&&a(b.result)})},renameTorrent:function(a,b,d,c){var e=this.torrents.all[a];if(!e)return false;this.exec({method:"torrent-rename-path",arguments:{ids:[a],path:b||e.name,name:d}},function(f){c&&c(f)})},closeSession:function(a){this.exec({method:"session-close"},
function(b){a&&a(b)})}};
